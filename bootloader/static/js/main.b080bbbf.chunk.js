(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(t,e,n){t.exports=n(23)},19:function(t,e,n){},21:function(t,e,n){},23:function(t,e,n){"use strict";n.r(e);var r=n(1),a=n.n(r),s=n(5),o=n.n(s),c=n(0),u=n.n(c),i=n(2),l=n(6),d=n(7),p=n(9),f=n(8),h=n(10),g=(n(19),n(3)),m=16,v=function(t){for(var e=[],n=0;n<t;n++)e.push(255);return e},w=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(parseInt(t.substring(n,n+2),16));return e},x=function(t){var e=[];if(t instanceof Array)return t.forEach(function(t){e.push(Math.floor(t/16)),e.push((t+16)%16)}),e;var n=t;do{e.push((n+16)%16),n>>=4,e.push((n+16)%16),n>>=4}while(0!==n);return e.reverse()},b=function(t){var e=[],n=0,r=0,a=1;return t.forEach(function(t){if(":"===t.substring(0,1)){var s=function(t,e){var n=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,7),16),a=9+2*n;return{dataLength:n,address:e+r,originalAddress:r,type:parseInt(t.substring(7,9),16),data:t.substring(9,a),checksum:t.substring(a,a+2)}}(t,r),o=s.type,c=s.address,u=s.originalAddress,i=s.data,l=s.checksum;2===o?(r=16*parseInt(i,16),console.log("".concat(a," changed address offset to ").concat(r," (").concat(t,")"))):4===o?(r=65536*parseInt(i,16),n=function(t){return"0000"===t?0:"0030"===t?1:"00F0"===t?2:"0020"===t?3:-1}(i),console.log("".concat(a," changed address offset to ").concat(r,", mode: ").concat(function(t){switch(t){case 0:return"program bytes";case 1:return"user id";case 2:return"config bytes";case 3:return"eeprom bytes";default:return"unknown"}}(n)," (").concat(t,")"))):0===o?(e.push({address:c,data:w(i),mode:n,checksum:l}),console.log("".concat(a,", addr: 0x").concat(c.toString(16)," (").concat(c,"), orig: 0x").concat(u.toString(16),", bytes: ").concat(i.length/2,", data: ").concat(i))):1===o?console.log("EOF found, address: ".concat(c,", data: ").concat(i,", checksum: ").concat(l)):console.log("Unknown type encountered: ",o,c,i,l)}else console.log("Unknown line format encountered: ",t);a++}),console.log("Finished parsing lines"),e},y=function(t,e,n){return n-(n+t+e)%n},k=function(t,e){var n,r,a=[],s=0,o=-2;t.forEach(function(t){var n,c=function(t,e){return Math.floor(t/e)}(t.address,e);if(c!==o&&c!==o+1){if(null!=r){var u,i=y(s,0,e);if(i)(u=r.data).push.apply(u,Object(g.a)(v(i)))}r={address:s=c*e,data:[]},a.push(r)}var l,d=t.address-s;d&&(l=r.data).push.apply(l,Object(g.a)(v(d)));(n=r.data).push.apply(n,Object(g.a)(t.data)),o=function(t,e,n){return Math.floor((t+e)/n)}(t.address,t.data.length,e),s=t.address+t.data.length});var c=a[a.length-1],u=y(c.address,c.data.length,e);return(n=c.data).push.apply(n,Object(g.a)(v(u))),a},O=function(t,e){var n=[];return t.forEach(function(t){for(var r=0;r<t.data.length;r+=e){var a=t.data.slice(r,r+e);n.push({data:a,dataString:a.join(),address:t.address+r})}}),n},E=function(){var t=Object(i.a)(u.a.mark(function t(e,n){var r,a,s,o,c;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=b(e),a=r.filter(function(t){return 0===t.mode}).sort(function(t,e){return t.address-e.address}),s=k(a,n),o=O(s,n),(c=o.map(function(t){return[m].concat(Object(g.a)(x(t.address)),[17],Object(g.a)(x(t.data)))})).push([18]),t.abrupt("return",c);case 7:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),j=function(){var t=Object(i.a)(u.a.mark(function t(e){var n,r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.url,r=e.path,t.abrupt("return",fetch("".concat(n).concat(r)).then(function(t){return t.text()}));case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),A={sysexAddress:"0x00, 0x2B, 0x60",xonikAddress:"0x22, 0x50, 0x50",input:"./input.hex",output:"./output.sysex",keepWatching:!1},S=function(t){var e=A[t];if(null==e)return console.log(t+" is missing"),null;var n=e.split(",").map(function(t){return t.trim()}).map(function(t){return parseInt(t)});return 3!==n.length?(console.log("Error: "+t+" must be exactly 3 bytes long."),null):(console.log("Using ".concat(t," ").concat(n[0],", ").concat(n[1],", ").concat(n[2])),n)},F=function(){var t=S("sysexAddress");if(null===t)return null;var e=S("xonikAddress");return null===e?null:{sysexAddress:t,xonikAddress:e}},N=function(t){return new Promise(function(e){return setTimeout(e,t)})},I=function(){var t=Object(i.a)(u.a.mark(function t(e,n){var r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<e.length)){t.next=7;break}return t.next=4,n(e[r],r,e);case 4:r++,t.next=1;break;case 7:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),C=function(){var t=Object(i.a)(u.a.mark(function t(e){var n,r,a,s,o,c,l,d,p,f;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.sysexAddress,r=e.xonikAddress,a=e.fileLines,s=e.output,o=e.delayBetweenBlocks,c=e.statusCallback,t.next=3,E(a,64);case 3:return l=t.sent,d=[240].concat(Object(g.a)(n),Object(g.a)(r)),p=[247],f=1,c("Writing"),t.next=10,I(l,function(){var t=Object(i.a)(u.a.mark(function t(e){var n;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("writing part "+f),console.log(e.map(function(t){return t.toString(16)}).join("")),s&&s.write([].concat(Object(g.a)(d),Object(g.a)(e),p)),n=Math.floor(1e3*f/l.length)/10,c("".concat(n,"% written")),f++,t.next=8,N(o);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}());case 10:c("Completed"),console.log("Sysex write completed");case 12:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),M=function(){var t=Object(i.a)(u.a.mark(function t(e,n,r){var a,s,o;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=F(),t.prev=1,t.next=4,j({url:"",path:"hexfiles/"+r});case 4:return s=t.sent,o=s.split("\n"),t.next=8,C({sysexAddress:a.sysexAddress,xonikAddress:a.xonikAddress,fileLines:o,delayBetweenBlocks:300,output:e,statusCallback:n});case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),console.log("oh damn",t.t0);case 13:case"end":return t.stop()}},t,this,[[1,10]])}));return function(e,n,r){return t.apply(this,arguments)}}(),B=function(t){function e(){var t;return Object(l.a)(this,e),(t=Object(p.a)(this,Object(f.a)(e).call(this))).state={midiAccess:null,outputs:[],selectedOutput:null,selectedFirmware:null,writing:!1,statusText:""},t}return Object(h.a)(e,t),Object(d.a)(e,[{key:"updateOutputs",value:function(){var t=this.state,e=t.midiAccess,n=t.selectedOutput,r=[];e.outputs.forEach(function(t){r.push(t)}),console.log("outputs",r),this.setState({outputs:r}),n&&null==e.outputs.get(n.id)&&(console.log("removing selected output"),this.setState({selectedOutput:null}))}},{key:"componentDidMount",value:function(){var t=Object(i.a)(u.a.mark(function t(){var e,n=this;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.requestMIDIAccess({sysex:!0});case 2:(e=t.sent).onstatechange=function(t){"statechange"===t.type&&"output"===t.port.type&&"open"!==t.port.connection&&(console.log("Midi access changed",t),n.updateOutputs())},this.setState({midiAccess:e}),this.updateOutputs();case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"selectOutput",value:function(t){var e=t.target.value;if("NONE"===e)console.log("No output selected"),this.setState({selectedOutput:null});else{var n=this.state.midiAccess.outputs.get(e);null!=n?(console.log("Selected output",e,n),this.setState({selectedOutput:n})):console.log("Could not select output")}}},{key:"selectFirmware",value:function(t){var e=t.target.value;"NONE"===e?(console.log("No firmware selected"),this.setState({selectedFirmware:null})):this.setState({selectedFirmware:e})}},{key:"writeFirmware",value:function(){var t=Object(i.a)(u.a.mark(function t(){var e=this;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==this.state.selectedOutput){t.next=3;break}return console.log("Cannot write, no output selected"),t.abrupt("return");case 3:return this.setState({writing:!0}),t.next=6,M({write:function(t){e.state.selectedOutput.send(t),console.log("Wrote",t)}},function(t){e.setState({statusText:t})},this.state.selectedFirmware);case 6:this.setState({writing:!1});case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=null===this.state.selectedOutput||null===this.state.selectedFirmware||this.state.writing;return a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("select",{onChange:function(e){return t.selectOutput(e)}},a.a.createElement("option",{value:"NONE"},"Please select a midi output"),this.state.outputs.map(function(t){return a.a.createElement("option",{key:t.id,value:t.id},t.name)})),a.a.createElement("br",null),a.a.createElement("select",{onChange:function(e){return t.selectFirmware(e)}},a.a.createElement("option",{value:"NONE"},"Then choose a firmware to upload"),a.a.createElement("option",{value:"mpg200.hex"},"MPG200")),a.a.createElement("br",null),a.a.createElement("button",{disabled:e,onClick:function(){return t.writeFirmware()}},"Write firmware"),a.a.createElement("p",null,a.a.createElement("div",null,"Status: ",this.state.statusText))))}}]),e}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(21);o.a.render(a.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[11,2,1]]]);
//# sourceMappingURL=main.b080bbbf.chunk.js.map