<!DOCTYPE html>
<html>
<head>
    <title>The exponential converter explained</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="stylesheet" type="text/css" href="../theory.css">

    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
  });





    </script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="../theory.js"></script>
    <script src="../jquery-2.1.1.min.js"></script>

</head>
<body>
<p>
<h1>Exponential convertion - the useful formulas</h1>
<p>
    The exponential converter / logarithmic converter is a very useful circuit, used for
    converting a linear CV to a logarithmic current in analog synthesizer VCOs and VCAs etc. They
    are usually build by exploiting a fundamental property of transistors where the transistor
    output current is a natural exponential function of the voltage between the transistor base
    and emitter. Single transistor exponential converters however, are terribly temperature
    sensitive, so a dual transistor scheme that compensates for many of the temperature effects
    is often used.
</p>
<p>
    This article describes four different variations of this circuit. I have seen several articles
    saying that you can change what transistor to connect the reference current to, and what base to
    use for controlling the converter. This text explains how. I will not
    go into details about how they compensate for temperature variations, but I will give you the
    necessary formulas and explain how I arrived at them.
</p>
<p>
    Check out my three articles on the VCO for explanations of how temperature compensation
    actually works.
</p>
<h2>The four configurations are:</h2>
<p>
<ul>
    <li>A: Decreasingly positive exponential (starting high positive and decreasing to close to 0)
    </li>
    <li>B: Increasingly positive exponential (starting close to 0 and increasing to high positive)
    </li>
    <li>C: Increasingly negative exponential (starting close to 0 and increasing to high negative)
    </li>
    <li>D: Decreasingly negative exponential (starting high negative and decreasing to close to 0)
    </li>
</ul>
<img src="./img/expo-converters-four.png" class="fullwidth"/>
</p>
<p>
    The four plots are derived from the same $-100mV$ to $+100mV$ control voltage (CV).
</p>
<h2>The test circuit looks like this:</h2>
<p>
    <img src="./img/expo-converters-four-circuit.png" class="fullwidth"/>
</p>
<p>
    There are only tiny variations in the circuits:
<ul>
    <li>For each exponential converter, a reference current is connected to the left transistor's
        collector.
    </li>
    <li>A and C have the CV connected to the right transistor's base (the other is grounded)</li>
    <li>B and D have the CV connected to the left transistor's base (the other is grounded)</li>
    <li>A and B are PNP transistors. For these, the reference current must be negative, i.e. flow
        out
        of the transistor's collector.
    </li>
    <li>A and B are NPN transistors. For these, the reference current must be positive, i.e. flow
        into the transistor's collector.
    </li>
</ul>
</p>

<h2>These are the formulas for the four exponential converters:</h2>
<div class="fact">
    <ul>
        <li>A: \(I_{out} = I_{ref} \cdot e^{-\frac{V_{cv}}{V_T}}\)</li>
        <li>B: \(I_{out} = I_{ref} \cdot e^{\frac{V_{cv}}{V_T}}\)</li>
        <li>C: \(I_{out} = I_{ref} \cdot e^{\frac{V_{cv}}{V_T}}\)</li>
        <li>D: \(I_{out} = I_{ref} \cdot e^{-\frac{V_{cv}}{V_T}}\)</li>
    </ul>
    <p>
        \(V_T = \frac{k \cdot T}{q}\)
    </p>
    <p>
    \(k = 1.38 \cdot 10^{-23}\) Joules/Kelvin<br>
    \(q = 1.6 \cdot 10^{-19}\) Coloumbs<br>
    \(T = \) absolute temperature in degrees Kelvinq (= degrees celcius + 273.16)
    </p>
</div>
<p>
    $V_T$ is $25.7mV$ at 25Â°C - see other documents on this site for temperature compensation
</p>
<p>
    It is also important to note that
</p>
<ul>
    <li>$I_{ref}$ and $I_{out}$ flows INTO the collectors for A and B</li>
    <li>$I_{ref}$ and $I_{out}$ flows OUT OF the collectors for C and D</li>
</ul>
</p>
<p>
    $I_{ref}$ is generated by the $1.5MOhm$ resistors connected to + or - $15V$ in the test circuit.
    Let's call the resistor $R_{ref}$ and the voltage $V_{ref}$.
</p>
<p>
    The reference current $I_{ref}$ is then:
</p>
<p>
    \(I_{ref} = \frac{V_{ref}}{R_{ref}}\)
</p>
<p>
    or \(\frac{1.5MOhm}{15V} = 10uA\) for C and D, \(\frac{1.5MOhm}{-15V} = -10uA\) for A and B.
</p>
<h2>Things to be aware of</h2>
<p>
<ul>
    <li>The output of the converter is a current, not a voltage</li>
    <li>The reference current sets the output current when $V_{cv}$ = 0</li>
    <li>
        The output current is doubled/halved by increasing/decreasing $V_{cv}$ by approx $17.5mV$.
        The
        exact
        value is temperature dependent. Doubling or halving the current is important, as a frequency
        change of one octave is equal to doubling or halving of the frequency.
    </li>
    <li>
        Design the pre-$V_{cv}$-input circuitry to produce a $17.5mV$ response that matches your
        wanted CV response - e.g. if your input CV is 0 to 5V and you want a $1oct/V$ response,
        you need to make a circuit with \(V_{out} = V_{in} \cdot 0.0175\).
    </li>
    <li>
        Add or subtract a voltage from the input CV to trim the starting points of octaves (tune a
        note)
    </li>
    <li>
        Adjust the division circuitry/attenuation factor in point (4) to adjust the V/oct (adjusts
        tracking)
    </li>
    <li>
        The voltage at the collector of the right transistor, $V_{c_{2}}$, cannot be determined by
        looking at the exponential converter alone - it depends on whatever you put after the
        converter. However, for the transistor to conduct, $V_{c}$ must be at least $0.25V$
        (approx) larger than $V_e$ for the NPN configuration, and $V_{c}$ must be at least
        $0.25V$ (approx) less than $V_e$ for the PNP configuration. This limits the maximum
        $I_{out}$, see example at the end.
    </li>
</ul>
</p>

<h1>
    Facts and background information
</h1>
<div class="fact">
    <ul>
        <li>Two transistors with connected emitters have the same $V_e$.</li>
        <li>
            The collector current $I_{c}$ is directly related to $V_{be}$
            <div>
                <a href="#" class="expandButton" onClick="openDiv">[see how]</a>
                <div class="details inset">
                    The collector current $I_{c}$ is directly related to voltage difference
                    between the base and the emitter, $V_{be}$, through the
                    Ebers-Moll equations. If one changes, the other changes. The only way $V_{be}$
                    can change is if $I_{c}$
                    also changes (and thus, changing $V_{be}$ changes $I_{c}$). TODO:and not to be
                    found
                    using the hef or something.
                </div>
            </div>
        </li>
        <li>$I_{ref}$ is constant (in our circuits)
            <div>
                <a href="#" class="expandButton" onClick="openDiv">[see how]</a>
                <div class="details inset">
                    If we just connected s resistor to the left collector and hoped to get s
                    constant
                    $I_{ref}$, we would be disappointed. $V_{c_{1}}$ will vary and thus $I_{ref}$
                    varies
                    too.
                    A constant $I_{ref}$ is generated by connecting a resistor $R_{ref}$ between a
                    known,
                    constant voltage and the collector of one of the transistors. The transistor is
                    then
                    placed within the feedback loop of an opamp, with the collector connected to the
                    negative
                    input and the emitter connected (through a resistor) to the opamp output. As the
                    collector is now at virual ground, the current flowing through $R_{ref}$ is
                    $\frac{V_{ref}}{R_{ref}}$. This same current flows through the collector, as the
                    opamp tries to make the sum of currents into its inputs zero.
                </div>
            </div>
        </li>
    </ul>
</div>
<p>
    Now let's figure out the exact formulas for the relationship between the two transistors'
    $V_{b}$
    and $I_{c}$:
</p>
<h3>Deducing the NPN equation</h3>
<p>
    The Ebers-Moll equation for an NPN transistor can be approximated as
</p>
<p>
    \(I_{c} = I_{s} \cdot e^{\frac{V_{be}}{V_T}}\)
</p>
<p>
    Rearranging for $V_{be}$ gives us
</p>
<p>
    \(V_{be} = V_T \cdot ln(\frac{I_{c}}{I_{s}})\)
</p>
Here's a little trick. Since $V_e$ is the same for both transistors, the difference in $V_{be}$
between the two transistors can be written as
<p>
    \(\Delta V_{be} = V_{be_{2}} - V_{be_{1}}\)<br>
    \(\Delta V_{be} = (V_{b_{2}} - V_e) - (V_{b_1} - V_e)\)<br>
    \(\Delta V_{be} = V_{b_{2}} - V_{b_1}\)
</p>
<p>The order of the bases in the delta is unimportant, as long as we use the same ordering
    for both voltages and currents we will end up at the same result.
</p>
<p>
    Also
</p>
<p>
    \(\Delta V_{be} = V_T \cdot ln(\frac{I_{c_{2}}}{I_{s}}) - V_T \cdot
    ln(\frac{I_{c_{2}}}{I_{s}})\)<br>
    \(\Delta V_{be} = V_T \cdot (ln(\frac{I_{c_{2}}}{I_{s}}) -ln(\frac{I_{c_{2}}}{I_{s}})\)<br>
    \(\Delta V_{be} = V_T \cdot ln(\frac{I_{c_{2}}}{I_{c_{1}}})\)
</p>
<p>
    So we get
</p>
<p>
    \(V_{b_{2}} - V_{b_1} = V_T \cdot ln(\frac{I_{c_{2}}}{I_{c_{1}}})\)<br>
    \(ln(\frac{I_{c_{2}}}{I_{c_{1}}}) = \frac{V_{b_{2}} - V_{b_1}}{V_T}\)<br>
    \(\frac{I_{c_{2}}}{I_{c_{1}}} = e^{\frac{V_{b_{2}} - V_{b_1}}{V_T}}\)
</p>
<p>
    For NPN:
</p>
<p class="fact">
    \(I_{c_{2}} = I_{c_{1}} \cdot e^{\frac{V_{b_{2}} - V_{b_1}}{V_T}}\)
</p>
<h3>Deducing the PNP equation</h3>
<p>
    The Ebers-Moll equation for a PNP transistor on the other hand can be approximated as
</p>
<p>
    \(I_{c} = I_{s} \cdot e^{\frac{V_{eb}}{V_T}}\)
</p>
<div>
    <a href="#" class="expandButton" onClick="openDiv">[show where the PNP equation came from]</a>
    <div class="details inset">
        <h3>Where did the PNP equation come from?</h3>
        <p>
            The NPN transistor's forward characteristics are, according to Microelectronic Circuit
            Design
            by Travis Blalock, Richard Jaeger - http://www.jaegerblalock.com/
        </p>
        <p>
            \(I_{c} = I_{s} \cdot (e^{\frac{V_{be}}{V_T}} - 1) = \alpha_{F} I_{ES} \cdot
            (e^{\frac{V_{be}}{V_T}} - 1)\) (5.21)
        </p>
        <p>
            and thus
        </p>
        <p>
            \(I_{ES} = \frac{I_{s}}{\alpha_{F}}\)
        </p>
        <p>
            which is also stated in 5.20
        </p>
        <p>
            The forward characteristics for the PNP are not clearly stated, but the Ebers-Moll
            Models for
            both tne NPN and the PNP are. For NPN it is:
        </p>
        <p>
            \(I_{c} = \alpha_{F} I_{ES} \cdot (e^{\frac{V_{be}}{V_T}} - 1) - I_{cs} \cdot
            (e^{\frac{V_{bc}}{V_T}} - 1)\)
        </p>
        <p>
            Here, we recognize the first part as the forward characteristic and the second as the
            reverse
            characteristic (5.22).
        </p>
        <p>
            For PNP it is
        </p>
        <p>
            \(I_{c} = \alpha_{F} I_{ES} \cdot (e^{\frac{V_{eb}}{V_T}} - 1) - I_{cs} \cdot
            (e^{\frac{V_{cb}}{V_T}} - 1)\)
        </p>
        <p>
            We know that the first part is the forward characteristic, so
        </p>
        <p>
            \(I_{c} = \alpha_{F} I_{ES} \cdot (e^{\frac{V_{eb}}{V_T}} - 1)\), and \(I_{ES} =
            \frac{I_{s}}{\alpha_{F}}\)<br>
        </p>
        <p>
            which means that the forward characteristic for the PNP is
        </p>
        <p>
            \(I_{c} = (e^{\frac{V_{eb}}{V_T}} - 1)\)
        </p>
        <p>
            Note that the only difference is the way we calculate the difference between $V_{b}$ and
            $V_e$ - a tiny but crucial difference.
        </p>
    </div>
</div>
<p>
    Rearranging for $V_{be}$ gives us
</p>
<p>
    \( V_{eb} = V_T \cdot ln(\frac{I_{c}}{I_{s}})\)
</p>
<p>
    Then the same trick: Since $V_e$ is the same for both transistors, the difference in $V_{be}$
    between the two transistors can be written as
</p>
<p>
    \(\Delta V_{eb} = V_{eb_{2}} - V_{eb_1}\)<br>
    \(\Delta V_{eb} = (V_e - V_{b_{2}}) - (V_e - V_{b_1})\)<br>
    \(\Delta V_{eb} = -V_{b_{2}} + V_{b_1}\)<br>
    \(\Delta V_{eb} = V_{b_1} + V_{b_{2}}\)
</p>
<p>
    Similarly,
</p>
<p>
    \(\Delta V_{eb} = V_T \cdot ln(\frac{I_{c_{2}}}{I_{s}}) - V_T \cdot
    ln(\frac{I_{c_{2}}}{I_{s}})\)<br>
    \(\Delta V_{eb} = V_T(ln(\frac{I_{c_{2}}}{I_{s}}) -ln(\frac{I_{c_{2}}}{I_{s}})\)<br>
    \(\Delta V_{eb} = V_T \cdot ln(\frac{I_{c_{2}}}{I_{c_{1}}})\)
</p>
<p>
    So we get
</p>
<p>
    \(V_{b_1} - V_{b_{2}} = V_T \cdot ln(\frac{I_{c_{2}}}{I_{c_{1}}})\)<br>
    \(ln(\frac{I_{c_{2}}}{I_{c_{1}}}) = \frac{V_{b_1} - V_{b_{2}}}{V_T}\)<br>
    \(\frac{I_{c_{2}}}{I_{c_{1}}} = e^{\frac{V_{b_1} - V_{b_{2}}}{V_T}}\)
</p>
<p>
    For PNP:
</p>
<p class="fact">
    \(I_{c_{2}} = I_{c_{1}} \cdot e^{\frac{V_{b_1} - V_{b_{2}}}{V_T}}\)
</p>
<p>
    We now have the formulas for both PNP and NPN transistors. They say nothing about which one of
    the collectors are to be considered the reference current, nor which one, if any of, the bases
    are grounded or which one is the control input. If we want to find $I_{c_{1}}$ based on
    $I_{c_{2}}$ instead, we just negate the exponent:
</p>
<p>
    \(a = b \cdot e^{x} => b = \frac{a}{e^{x}} = a \cdot \frac{1}{e^{x}} = a \cdot e^{-x}\)
</p>
<h2>What is going on in the circuits?</h2>
<p>
    Before the final transformation into the formulas above, let's stop to think about what is
    actually going on in the circuits.
</p>
<p>
    The base of one of the transistors has been grounded in each circuit. Why?
</p>
<h3>
    If we ground the base of the transistor that is inside the feedback loop (A, C):
</h3>
<ul>
    <li>
        We now have a transistor with a fixed $V_{b_1}$ and a fixed $I_{c_{1}}$ ($I_{ref}$). As
        mentioned, a fixed $V_c$ means a fixed $V_{be}$, and since $V_{b}$ is also fixed, $V_e$
        will be constant. It cannot go anywhere.
    </li>
    <li>
        Therefore, as we change $V_{b_{2}}$ (the CV), the difference between the base
        of the right transistor and the shared emitter, $V_{be_{2}}$, will
        change, and $I_{c_{2}}$
        ($I_{out}$) changes.
    </li>
</ul>
<h3>For A</h3>
<p>
    <img src="./img/A-V_e-and-V_b_2.png" class="fullwidth"/><br>
    $V_e$ (green) vs $V_{b_{2}}$ ($=V_{cv}$, blue). For a PNP transistor, the emitter
    voltage is higher than the base voltage when the transistor is on. The emitter
    voltage stays constant so the difference between the emitter and the base, $V_{be}$,
    decreases when $V_{cv}$ increases.
</p>
<p>
    <img src="./img/A-V_e-and-I_out.png" class="fullwidth"/><br>
    Green line is $I_{out}$, dotted line is $V_e$. As $V_{cv}$ increases and thus $V_{be}$
    decreases, the output current $I_{out}$ decreases.
</p>
<h3>For C</h3>
<p>
    <img src="./img/C-V_e-and-V_b_2.png" class="fullwidth"/><br>
    $V_e$ (blue) vs $V_{b_{2}}$ ($=V_{cv}$, green). For an NPN transistor, the emitter
    voltage is lower than the base voltage when the transistor is on. The emitter voltage stays
    constant so the difference between the emitter and the base, $V_{be}$, increases when
    $V_{cv}$ increases.
</p>
<p>
    <img src="./img/C-V_e-and-I_out.png" class="fullwidth"/><br>
    Green line is $I_{out}$, dotted line is $V_e$. As $V_{cv}$ increases and thus $V_{be}$
    increases, the output current $I_{out}$ increases. As
    the reference current is flowing into the transistor, the output is also a negative current.

</p>
<h3>
    If we ground the base of the transistor connected to the output (B, D):
</h3>
<ul>
    <li>
        The transistor inside the feedback loop still has a fixed $I_{c_{1}}$, which means that
        $V_{be_{1}}$ is also fixed. But now the CV is connected to the base, i.e. $V_{b_1}$ is
        variable. Thus, to keep $I_{c_{1}}$ constant, $V_e$ must also change.
    </li>
    <li>
        The other transistor however, has its base grounded. $V_{b_{2}}$ is constant. Now, as
        $V_{b_1}$ changes, $V_e$ changes. This in turn changes difference between
        the right base and the emmiter, $V_{be_{2}}$, and as
        $V_{be_{2}}$ changes, $I_{c_{2}}$ ($I_{out}$) changes.
    </li>
</ul>
<h3>For B</h3>
<p>
    <img src="./img/B-V_e-red_V_b_1-green.png" class="fullwidth"/><br>
    $V_e$ (red) vs $V_{b_1}$ ($=V_{cv}$, green). For a PNP transistor, the emitter
    voltage is higher than the base voltage when the transistor is on. The difference between
    the left base voltage $V_{b_1}$ and the emitter voltage $V_e$ stays constant, but
    $V_{b_1}$ (=$V_{cv}$) changes, so $V_e$ changes with the same amount. The right base,
    $V_{b_{2}}$ is tied to 0, so as the emitter voltage increases, the difference between the
    emitter and the right base, $V_{be_{2}}$, increases.
</p>
<p>
    <img src="./img/B-V_e-and-I_out.png" class="fullwidth"><br>
    Blue line is $I_{out}$, green line is $V_e$. As $V_{cv}$ increases and thus $V_{be_{2}}$
    increases, the output current $I_{out}$ increases.
</p>
<h3>For D</h3>
<p>
    <img src="./img/D-V_e-blue_V_b_1-green.png" class="fullwidth"/><br>
    For D: $V_e$ (green) vs $V_{b_1}$ ($=V_{cv}$, blue). For an NPN transistor, the emitter
    voltage is lower than the base voltage when the transistor is on. The difference between
    the left base voltage $V_{b_1}$ and the emitter voltage $V_e$ stays constant, but
    $V_{b_1}$ (=$V_{cv}$) changes, so $V_e$ changes with the same amount. The right base,
    $V_{b_{2}}$ is tied to 0, so as the emitter voltage increases, the difference between the
    emitter and the base, $V_{be_{2}}$, decreases.
</p>
<p>
    <img src="./img/D-V_e-and-I_out.png" class="fullwidth"><br>
    Green line is $I_{out}$, blue line is $V_e$. As $V_{cv}$ increases and thus $V_{be_{2}}$
    decreases, the output current $I_{out}$ decreases.  As
    the reference current is flowing into the transistor, the output is also a negative current.</p>
<p>
    Thus, we can control $I_{out}$ by changing either one of the bases and keeping the other fixed.
</p>

<h2>The final transformation</h2>
<p>
    Let's deduce the exact formulas for each of our circuits.
</p>
<h3>For A</h3>
<p>
    A is a PNP configuration, so we'll use
</p>
<p>
    \(I_{c_{2}} = I_{c_{1}} \cdot e^{\frac{V_{b_1} - V_{b_{2}}}{V_T}}\)
</p>
<p>
    If we set
</p>
<p>
    \(I_{c_{2}} = I_{out}\)<br>
    \(I_{c_{1}} = I_{ref}\)<br>
    \(V_{b_1} = 0\) (grounded)<br>
    $V_{b_{2}}$ is our control, $V_{cv}$
</p>
<p>
    we're left with
</p>
<p>
    A: \(I_{out} = I_{ref} \cdot e^{-\frac{V_{cv}}{V_T}}\)
</p>
<h3>For B</h3>
<p>
    B is also a PNP configuration, so we'll use
</p>
<p>
    \(I_{c_{2}} = I_{c_{1}} \cdot e^{\frac{V_{b_1} - V_{b_{2}}}{V_T}}\)
</p>
<p>
    If we set
</p>
<p>
    \(I_{c_{2}} = I_{out}\)<br>
    \(I_{c_{1}} = I_{ref}\)<br>
    $V_{b_1}$ is our control, $V_{cv}$<br>
    \(V_{b_{2}} = 0\) (grounded)
</p>
<p>
    we're left with
</p>
<p>
    B: \(I_{out} = I_{ref} \cdot e^{\frac{V_{cv}}{V_T}}\)
</p>
<h3>For C</h3>
<p>
    C is an NPN configuration, so we'll use
</p>
<p>
    \(I_{c_{2}} = I_{c_{1}} \cdot e^{\frac{V_{b_{2}} - V_{b_1}}{V_T}}\)
</p>
<p>
    If we set
</p>
<p>
    \(I_{c_{2}} = I_{out}\)<br>
    \(I_{c_{1}} = I_{ref}\)<br>
    \(V_{b_1} = 0\) (grounded)<br>
    $V_{b_{2}}$ is our control, $V_{cv}$
</p>
<p>
    we're left with
</p>
<p>
    C: \(I_{out} = I_{ref} \cdot e^{\frac{V_{cv}}{V_T}}\)
</p>
<h3>For D</h3>
<P>
    D is also an NPN configuration, so we'll use
</P>
<p>
    \(I_{c_{2}} = I_{c_{1}} \cdot e^{\frac{V_{b_{2}} - V_{b_1}}{V_T}}\)
<p>
    If we set
</p>
<p>
    \(I_{c_{2}} = I_{out}\)<br>
    \(I_{c_{1}} = I_{ref}\)<br>
    $V_{b_1}$ is our control $V_{cv}$<br>
    \(V_{b_{2}} = 0\) (grounded)
</p>
<p>
    we're left with
</p>
<p>
    D: \(I_{out} = I_{ref} \cdot e^{-\frac{V_{cv}}{V_T}}\)
</p>


<h2>Direction, $I_{out}$</h2>

<h2>Max $I_{out}$</h2>
<p>
    As mentioned, $V_{c_{2}}$ is determined by $I_{out}$ and the circuit after the collector. Let's
    look
    at an example:
</p>
<p>
    Here, $I_{out}$ is fed through an 18k resistor. Following Ohms law, the voltage across the
    resistor has to be $U = R \cdot I = 18kOhm \cdot I_{out}$. As the bottom of the resistor is
    tied to $-15V$, the side connected to the collector must have a voltage
    \(V_{c_{2}} = -15V + 18kOhm \cdot I_{out}\).
</p>
<p>
    As also mentioned, $V_{c}$ for a PNP transistor must be at least $0.25V$ less than $V_e$. It
    is thus the value of $V_e$ that limits the maximum $I_{out}$:
</p>
<p>
    \(I_{out_{max}} = \frac{(V_e - 0.25) + 15V}{18kOhm}\), and $V_e$ is a result of $I_{ref}$.
</p>
<p>
    <img src="./img/B-v_ce-pinchoff-v_b_1-red_v_e-V_c-blue-I_out-lightblue.png"
         class="fullwidth"/><br>
    This shows what happens as the output current for B increases. The red line is $V_{b_1}$,
    the green is $V_e$. They are both increasing though it is hard to see in this image. As a result
    of this, $I_{out}$, the light blue line, also increases. This means that to adhere to Ohms law,
    the voltage across the 18k resistor in the test circuit increases too, which in turn means
    that $V_{c_{2}}$ increases - this is the dark blue line . At around $V_{b_1}=115mV$ the
    difference between the collector voltage and the emitter voltage is no longer > 0.25V and
    the transistor won't conduct any larger current. Thus the max $I_{out}$ has been reached.
</p>
<h2>$R_e$</h2>
<p>
    $R_e$ limits the current that flows into the constant current-generator op amp. To keep the
    current constant, it has to sink (or source) exactly $I_{ref} + I_{out}$. It does this by
    moving its output voltage up and down. The voltage across $R_e$ follows Ohms law, \(V_{R_e} =
    R_e \cdot I_e = R_e \cdot (I_{ref} + I_{out}) \). When $V_{R_e}$ gets too large, the opamp
    cannot pull its output further up or down, and $I_{out}$ cannot get any higher. The smaller
    the value for $R_e$, the less voltage across it.
    <img src="./img/B-opamp-output-voltage-breakdown.png" class="fullwidth"/><br>
    Here we have replaced the 1.5k $R_e$ in test circuit B with a 150k resistor. This plot shows
    the opamp output voltage as the CV increases. At around 50mV the opamp has reached its
    maximum output voltage and it cannot compensate for any larger currents. We have once again
    reached the maximum for our circuit.
</p>

<script>
  $(".expandButton").click(function (event) {
    event.preventDefault();
    var detailsDiv = $(event.target).siblings(".details").first();
    detailsDiv.toggle();
  });
</script>
</body>
</html>
